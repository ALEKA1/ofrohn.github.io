// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,a){var n=e(t.map(function(t){return t*T}),a);return n.map(function(t){return t/T})}function e(t,e){var a,n,r,l,i,o,s,c,f,p,u=1e-5;return e?(o=t[0],0>o&&(o+=j),s=t[1],o-=e[0],l=e[1],i=e[2],a=Math.sin(s)*Math.sin(l)-Math.cos(s)*Math.cos(l)*Math.cos(o),Math.abs(a)<u&&(a=-Math.cos(s+l)+Math.cos(s)*Math.cos(l)*(1-Math.cos(o))),n=-Math.cos(s)*Math.sin(o),c=0!==a||0!==n?Math.atan2(n,a):o-Math.PI,f=i+c,f>Math.PI&&(f-=j),o%Math.PI===0?(p=s+Math.cos(o)*l,p>A&&(p=Math.PI-p),-A>p&&(p=-Math.PI-p)):(r=Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(o),Math.abs(r)>.99?(p=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),0>r&&(p*=-1)):p=Math.asin(r)),[f,p]):t}function a(t,e){if("equatorial"===e)return t;for(var a=S[e],r=t.features,l=0;l<r.length;l++)r[l].geometry.coordinates=n(r[l],a);return t}function n(e,a){var n=[];switch(e.geometry.type){case"Point":n=t(e.geometry.coordinates,a);break;case"LineString":n.push(r(e.geometry.coordinates,a));break;case"MultiLineString":n=l(e.geometry.coordinates,a);break;case"Polygon":n.push(r(e.geometry.coordinates[0],a));break;case"MultiPolygon":n.push(l(e.geometry.coordinates[0],a))}return n}function r(e,a){for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],a));return n}function l(t,e){for(var a=[],n=0;n<t.length;n++)a.push(r(t[n],e));return a}function i(t){return document.getElementById(t)}function o(t){return t+"px"}function s(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function c(t,e){return null!==t&&hasOwnProperty.call(t,e)}function f(t){return!isNaN(parseFloat(t))&&isFinite(t)}function p(t){function e(){var e=this;switch(e.id){case"width":if(m(e)===!1)return;t.width=e.value;break;case"projection":t.projection=e.options[e.selectedIndex].value;break;case"transform":var a=t.transform;t.transform=e.options[e.selectedIndex].value,g(t.transform,a),t.center[0]=i("centerx").value}P.display(t)}function a(){var e=this,a=i("centerx"),n=i("centery");switch(e.id){case"centerx":if(m(e)===!1)return;if(t.center[0]="equatorial"!==t.transform?e.value:e.value>12?15*e.value-360:15*e.value,""===n.value)return;t.center[1]=n.value;break;case"centery":if(m(e)===!1)return;if(t.center[1]=e.value,""===a.value)return;t.center[0]="equatorial"!==t.transform?a.value:a.value>12?15*a.value-360:15*a.value}P.rotate(t)}function n(){var e,a=this;switch(a.type){case"checkbox":e=a.checked,u(a);break;case"number":if(m(a)===!1)return;e=a.value;break;case"color":e=a.value}r(a.id,e),P.apply(t)}function r(e,a){var n=e.split("-");switch(n.length){case 1:t[n[0]]=a;break;case 2:t[n[0]][n[1]]=a;break;case 3:t[n[0]][n[1]][n[2]]=a;break;default:return}}var l=P.projections(),o=P.eulerAngles(),s=d3.select("#form").append("div").attr("class","ctrl"),c=s.append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),p=c.append("div").attr("class","col");p.append("label").attr("title","Map width, 0 indicates full width").attr("for","width").html("Width "),p.append("input").attr("type","number").attr("maxlength","4").attr("max","9999").attr("min","0").attr("title","Map width").attr("id","width").attr("value",t.width).on("change",e),p.append("span").html("px"),p.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var d=p.append("select").attr("id","projection").on("change",e),y=0,w=Object.keys(l).map(function(e,a){var n=l[e].clip&&l[e].clip===!0?l[e].n+" (hemi)":l[e].n;return e===t.projection&&(y=a),{o:e,n:n}});d.selectAll("option").data(w).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),d.property("selectedIndex",y),y=0,p.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),d=p.append("select").attr("id","transform").on("change",e),w=Object.keys(o).map(function(e,a){return e===t.transform&&(y=a),{o:e,n:e.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}}),d.selectAll("option").data(w).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),d.property("selectedIndex",y),p.append("br"),p.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),p.append("input").attr("type","number").attr("id","centerx").attr("title","Center right ascension/lngitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",a),p.append("span").attr("id","cxunit").html("h"),p.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",a),p.append("span").html("Â°"),b(t.center),p.append("input").attr("type","button").attr("id","show").attr("value","Show"),p=c.append("div").attr("class","col"),p.append("label").attr("class","header").attr("for","stars-show").html("Stars"),p.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",t.stars.show).on("change",n),p.append("label").attr("for","stars-limit").html("down to magnitude"),p.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit").attr("value",t.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",n),p.append("label").attr("for","stars-colors").html("with spectral colors"),p.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",t.stars.colors).on("change",n),p.append("label").attr("for","stars-color").html("or default color "),p.append("input").attr("type","color").attr("id","stars-style-fill").property("value",t.stars.style.fill).on("change",n),p.append("br"),p.append("label").attr("for","stars-names").html("Show names"),p.append("input").attr("type","checkbox").attr("id","stars-names").on("change",n),p.append("label").attr("for","stars-proper").html("proper names (if any)"),p.append("input").attr("type","checkbox").attr("id","stars-proper").property("checked",t.stars.proper).on("change",n),p.append("label").attr("for","stars-desig").attr("title","include HD/HIP designations").html("all designations"),p.append("input").attr("type","checkbox").attr("id","stars-desig").property("checked",t.stars.desig).on("change",n),p.append("label").attr("for","stars-namelimit").html("down to mag"),p.append("input").attr("type","number").attr("id","stars-namelimit").attr("title","Star name display limit").attr("value",t.stars.namelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",n),u(i("stars-show")),p=c.append("div").attr("class","col"),p.append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),p.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",t.dsos.show).on("change",n),p.append("label").attr("for","dsos-limit").html("down to mag"),p.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit").attr("value",t.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",n),p.append("label").attr("for","dsos-names").html("with names"),p.append("input").attr("type","checkbox").attr("id","dsos-names").property("checked",t.dsos.names).on("change",n),p.append("label").attr("for","dsos-desig").html("or designations"),p.append("input").attr("type","checkbox").attr("id","dsos-desig").property("checked",t.dsos.desig).on("change",n),p.append("label").attr("for","dsos-namelimit").html("down to mag"),p.append("input").attr("type","number").attr("id","dsos-namelimit").attr("title","DSO name display limit").attr("value",t.dsos.namelimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",n),u(i("dsos-show")),p=c.append("div").attr("class","col"),p.append("label").attr("class","header").html("Constellations"),p.append("label").attr("for","constellations-names").html("Show names"),p.append("input").attr("type","checkbox").attr("id","constellations-names").property("checked",t.constellations.names).on("change",n),p.append("label").attr("for","constellations-desig").html("abbreviated"),p.append("input").attr("type","checkbox").attr("id","constellations-desig").property("checked",t.constellations.desig).on("change",n),p.append("label").attr("for","constellations-lines").html("with lines"),p.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",t.constellations.lines).on("change",n),p.append("label").attr("for","constellations-bounds").html("with boundaries"),p.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",t.constellations.bounds).on("change",n),u(i("constellations-names")),p=c.append("div").attr("class","col"),p.append("label").attr("class","header").html("Lines"),p.append("label").attr("title","X/Y grid lines").attr("for","lines-graticule").html("Graticule"),p.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",t.lines.graticule.show).on("change",n),p.append("label").attr("for","lines-equatorial").html("Equator"),p.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",t.lines.equatorial.show).on("change",n),p.append("label").attr("for","lines-ecliptic").html("Ecliptic"),p.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",t.lines.ecliptic.show).on("change",n),p.append("label").attr("for","lines-galactic").html("Galactic plane"),p.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",t.lines.galactic.show).on("change",n),p.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),p.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",t.lines.supergalactic.show).on("change",n),p=c.append("div").attr("class","col"),p.append("label").attr("class","header").html("Other"),p.append("label").attr("for","mw-show").html("Milky Way"),p.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",t.mw.show).on("change",n),p.append("label").attr("for","background").html("Background color"),p.append("input").attr("type","color").attr("id","background-fill").attr("value",t.background.fill).on("change",n),p.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").html("Adaptable sizes"),p.append("input").attr("type","checkbox").attr("id","adaptable").property("checked",t.adaptable).on("change",n),s.append("div").attr("id","error"),i("show").onclick=function(){var e=i("centerx"),a=i("centery");return f(t.width)?""===e.value&&""!==a.value||""===a.value&&""!==e.value?(h(e,"Both center coordinates need to be given"),!1):(P.display(t),!1):(h(i("width"),"Check Width setting"),!1)},v(),g(t.transform)}function u(t){var e,a=t.id;switch(a){case"stars-show":e=!i(a).checked;for(var n=0;n<_[a].length;n++)d(_[a][n],e);case"stars-names":for(e=!i("stars-names").checked||!i("stars-show").checked,n=0;n<_["stars-names"].length;n++)d(_["stars-names"][n],e);break;case"dsos-show":for(e=!i(a).checked,n=0;n<_[a].length;n++)d(_[a][n],e);case"dsos-names":for(e=!i("dsos-names").checked||!i("dsos-show").checked,n=0;n<_["dsos-names"].length;n++)d(_["dsos-names"][n],e);break;case"constellations-show":for(e=!i(a).checked,n=0;n<_[a].length;n++)d(_[a][n],e)}}function d(t,e){var a=i(t);a.disabled=e,a.previousSibling.style.color=e?"#999":"#000"}function h(t,e){d3.select("#error").html(e).style({top:o(t.offsetTop+t.offsetHeight+1),left:o(t.offsetLeft),opacity:1})}function m(t){var e=t.value;return f(e)?(e=parseFloat(e),e<t.min||e>t.max?(h(t,t.title+" must be between "+t.min+" and "+t.max),!1):(d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0)):(h(t,t.title+": check field value"),!1)}function g(t,e){var a=i("centerx");e&&("equatorial"===t&&"equatorial"!==e?(a.value=s(a.value/15,1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=s(15*a.value,1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",i("cxunit").innerHTML="h"):(a.min="-180",a.max="180",i("cxunit").innerHTML="Â°")}function b(t){var e=i("centerx"),a=i("centery");e&&a&&(null===t&&(t=[0,0]),e.value="equatorial"!==y.transform?s(t[0],1):t[0]<0?s(t[0]/15+24,1):s(t[0]/15,1),a.value=s(t[1],1))}function v(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},l=P.settings();return a=l.dsos.data,t=a.match(n),null!==t&&(r.d=parseFloat(t[t.length-1])),6!=r.d&&(i("dsos-limit").max=r.d,i("dsos-namelimit").max=r.d),e=l.stars.data,t=e.match(n),null!==t&&(r.s=parseFloat(t[t.length-1])),6!=r.s&&(i("stars-limit").max=r.s,i("stars-namelimit").max=r.s),r}var y,w,k,M,x,I,P={version:"0.5.0",container:null,data:[]};P.display=function(e){function n(t){var e=w.scale()*t;w.scale([e]),M.scale([e]),f()}function r(t){y=E.set(t),f()}function l(t){y=E.set(t),rot=w.rotate(),lt=B(y.center),lt[2]=rot[2],it=[-lt[0],-lt[1]],w.rotate(lt),f()}function s(){if(!(y.width&&y.width>0)){J=L(),tt=J/U;var t=$.scale*J/1024;st.attr("width",J).attr("height",tt),M.scale([t]),w.translate([J/2,tt/2]).scale([t]),k.translate([J/2,tt/2]),X&&(X.style.height=o(tt)),f()}}function f(){var t=w.rotate();k.scale(w.scale()),y.adaptable&&(rt=Math.sqrt(w.scale()/et)),at=y.stars.size*rt,it=[-t[0],-t[1]],b(it),W(),d(y.background),Q.selectAll(".outline").attr("d",I),ct.fill(),y.mw.show&&Q.selectAll(".mw").each(function(t){d(y.mw.style),x(t),ct.fill()});for(var e in y.lines)c(y.lines,e)&&y.lines[e].show===!0&&(d(y.lines[e]),Q.selectAll("."+e).attr("d",x),ct.stroke());y.constellations.names&&(h(y.constellations.namestyle),Q.selectAll(".constname").each(function(t){if(u(t.geometry.coordinates)){var e=w(t.geometry.coordinates);ct.fillText(V(t),e[0],e[1])}})),y.constellations.lines&&Q.selectAll(".constline").each(function(t){d(y.constellations.linestyle),x(t),ct.stroke()}),y.constellations.bounds&&Q.selectAll(".boundaryline").each(function(t){d(y.constellations.boundstyle),x(t),ct.stroke()}),y.stars.show&&(d(y.stars.style),Q.selectAll(".star").each(function(t){if(u(t.geometry.coordinates)&&t.properties.mag<=y.stars.limit){var e=w(t.geometry.coordinates),a=H(t);ct.fillStyle=O(t),ct.beginPath(),ct.arc(e[0],e[1],a,0,2*Math.PI),ct.closePath(),ct.fill(),y.stars.names&&t.properties.mag<=y.stars.namelimit*rt&&(h(y.stars.namestyle),ct.fillText(F(t),e[0]+a,e[1]+a))}})),y.dsos.show&&Q.selectAll(".dso").each(function(t){if(u(t.geometry.coordinates)&&g(t.properties,y.dsos.limit)){var e=(d3.select(this),w(t.geometry.coordinates)),a=t.properties.type;d(y.dsos.symbols[a]);var n=v(t,e);c(y.dsos.symbols[a],"stroke")?ct.stroke():ct.fill(),y.dsos.names&&g(t.properties,y.dsos.namelimit)&&(h(y.dsos.namestyle),ct.fillStyle=y.dsos.symbols[a].fill,ct.fillText(_(t),e[0]+n,e[1]+n))}}),P.data.length>0&&P.data.forEach(function(t){t.redraw()}),d(y.background),Q.selectAll(".outline").attr("d",I),ct.stroke(),y.controls&&m(w.scale())}function u(t){return $.clip&&d3.geo.distance(it,t)>A?0:1}function d(t){ct.fillStyle=t.fill,ct.strokeStyle=t.stroke||null,ct.lineWidth=t.width||null,ct.globalAlpha=t.opacity||1,ct.font=t.font,ct.setLineDash(c(t,"dash")?t.dash:[]),ct.beginPath()}function h(t){ct.fillStyle=t.fill,ct.textAlign=t.align||"left",ct.textBaseline=t.baseline||"bottom",ct.globalAlpha=t.opacity||1,ct.font=t.font}function m(t){i("zoomin").disabled=t>4.5*et,i("zoomout").disabled=1.111*et>t}function g(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function v(t,e){var a=t.properties,n=T(a)||9,r=j(a.type);return G.symbol().type(r).size(n).position(e)(ct),Math.sqrt(n)/2}function j(t){return t&&c(y.dsos.symbols,t)?y.dsos.symbols[t].shape:"circle"}function T(t){return t.mag&&999!=t.mag?Math.pow(2*at-t.mag,1.4):Math.pow(parseInt(t.dim)*at/7,.5)}function _(t){var e=t.properties;if(""!==e.name)return y.dsos.desig&&e.desig?e.desig:e.name}function F(t){var e=t.properties.desig;return y.stars.proper&&""!==t.properties.name&&(e=t.properties.name),y.stars.desig?e:e.replace(/^H(D|IP).+/,"")}function H(t){var e=t.properties.mag;if(null===e)return.1;var a=at*Math.exp(nt*(e+2));return Math.max(a,.1)}function O(t){var e=t.properties.bv;return!y.stars.colors||isNaN(e)?y.stars.style.fill:C(e)}function V(t){return y.constellations.desig?t.properties.desig:t.properties.name}function W(){ct.clearRect(0,0,J+Z[0],tt+Z[1])}function L(){return y.width&&y.width>0?y.width:X&&""!==X.style.width&&"100%"!==X.style.width?X.clientWidth-Z[0]:window.innerWidth-2*Z[0]}function B(t){if(null===t)return[0,0];var e=z.equatorial;return[e[0]-t[0],e[1]-t[1],e[2]]}var N,R,Q=P.container;y=E.set(e),y.stars.size=y.stars.size||7;var X=i(y.container);if(X){R="#"+y.container;var Y=window.getComputedStyle(X,null);parseInt(Y.width)||y.width||(X.style.width=o(window.innerWidth))}else R="body",X=null;if(c(D,y.projection)){var $=D[y.projection],K=y.transform||"equatorial",U=$.ratio||2,Z=[16,16],J=L(),tt=J/U,et=$.scale*J/1024,at=y.stars.size,nt=-.28,rt=1,lt=B(y.center),it=[-lt[0],-lt[1]],ot=y.datapath||"";ot=ot.replace(/([^\/]$)/,"$1/"),"body"!=R&&(i(y.container).style.height=o(tt)),w=P.projection(y.projection).rotate(lt).translate([J/2,tt/2]).scale([et]),k=P.projection(y.projection).translate([J/2,tt/2]).scale([et]),$.clip&&(w.clipAngle(90),N=d3.geo.circle().angle([90])),M=d3.geo.zoom().projection(w).center([J/2,tt/2]).scaleExtent([et,5*et]).on("zoom.redraw",f);var st=d3.selectAll("canvas");0===st[0].length&&(st=d3.select(R).append("canvas")),st.attr("width",J).attr("height",tt);var ct=st.node().getContext("2d"),ft=d3.geo.graticule().minorStep([15,10]);x=d3.geo.path().projection(w).context(ct),I=d3.geo.path().projection(k).context(ct),Q?Q.selectAll("*").remove():Q=d3.select(R).append("container"),y.interactive?st.call(M):st.attr("style","cursor: default!important"),N?Q.append("path").datum(N).attr("class","outline"):Q.append("path").datum(ft.outline).attr("class","outline");for(var pt in y.lines)c(y.lines,pt)&&("graticule"===pt?Q.append("path").datum(ft).attr("class","graticule"):Q.append("path").datum(d3.geo.circle().angle([90]).origin(t(q[pt],S[K]))).attr("class",pt));d3.json(ot+"mw.json",function(t,e){if(t)return window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t);var n=a(e,K);Q.selectAll(".mway").data(n.features).enter().append("path").attr("class","mw"),f()}),d3.json(ot+"constellations.json",function(t,e){if(t)return console.warn(t);var n=a(e,K);Q.selectAll(".constnames").data(n.features).enter().append("text").attr("class","constname"),f()}),d3.json(ot+"constellations.bounds.json",function(t,e){if(t)return console.warn(t);var n=a(e,K);Q.selectAll(".bounds").data(n.features).enter().append("path").attr("class","boundaryline"),f()}),d3.json(ot+"constellations.lines.json",function(t,e){if(t)return console.warn(t);var n=a(e,K);Q.selectAll(".lines").data(n.features).enter().append("path").attr("class","constline"),f()}),d3.json(ot+y.stars.data,function(t,e){if(t)return console.warn(t);var n=a(e,K);Q.selectAll(".stars").data(n.features).enter().append("path").attr("class","star"),f()}),d3.json(ot+y.dsos.data,function(t,e){if(t)return console.warn(t);var n=a(e,K);Q.selectAll(".dsos").data(n.features).enter().append("path").attr("class","dso"),f()}),this.data.length>0&&this.data.forEach(function(t){c(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),d3.select(window).on("resize",s),y.controls===!0&&null===i("zoomin")&&(d3.select(R).append("input").attr("type","button").attr("id","zoomin").attr("value","+").on("click",function(){n(1.111)}),d3.select(R).append("input").attr("type","button").attr("id","zoomout").attr("value","â").on("click",function(){n(.9)})),y.form===!0&&null===i("params")&&p(y),this.container=Q,this.clip=u,this.map=x,this.mapProjection=w,this.resize=function(){s()},this.apply=function(t){r(t)},this.rotate=function(t){l(t)}}},P.projection=function(t){var e,a,n;if(!c(D,t))throw new Error("Projection not supported: "+t);return e=D[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,n=function(t,e){var n=a(-t,e);return n},n.invert=function(t,e){var n=a.invert(t,e);return n[0]*=-1,n},d3.geo.projection(n)};var z={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},q={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};P.eulerAngles=function(){return z},P.poles=function(){return q};var j=2*Math.PI,A=Math.PI/2,T=Math.PI/180;P.graticule=function(e,a,n){var r;if(n&&"equatorial"!=n){for(r=10;170>=r;r+=10)e.append("path").datum(d3.geo.circle().angle([r]).origin(q[n])).attr("class","gridline").attr("d",a);for(r=10;180>=r;r+=10)e.append("path").datum(d3.geo.circle().angle([90]).origin(t([r,0],S["inverse "+n]))).attr("class","gridline").attr("d",a)}};var S={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*T}))},add:function(t,e){return e&&t&&3===e.length&&!this.hasOwnProperty(t)?(this[t]=e.map(function(t){return t*T}),this[t]):void 0}};S.init(),P.euler=function(){return S},P.add=function(t){var e={};return c(t,"type")?"dso"!==t.type||c(t,"file")&&c(t,"callback")?"line"!==t.type||c(t,"callback")?(c(t,"file")&&(e.file=t.file),e.type=t.type,c(t,"callback")&&(e.callback=t.callback),c(t,"redraw")&&(e.redraw=t.redraw),void P.data.push(e)):console.log("Can't add line"):console.log("Can't add data file"):console.log("Missing type")};var E={width:0,projection:"aitoff",transform:"equatorial",center:null,background:{fill:"#000000",stroke:"#000000",opacity:1},adaptable:!0,interactive:!0,form:!1,controls:!0,container:"map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},names:!0,proper:!1,desig:!1,namestyle:{fill:"#ddddbb",font:"11px Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},namelimit:2.5,size:7,data:"stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namestyle:{fill:"#cccccc",font:"11px Helvetica, Arial, serif",align:"left",baseline:"top"},namelimit:4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#00ooff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,desig:!0,namestyle:{fill:"#cccc99",font:"12px Helvetica, Arial, sans-serif",align:"center",baseline:"middle"},lines:!0,linestyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundstyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[2,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},set:function(t){var e,a,n={};if(!t)return this;for(e in this)if(c(this,e)&&"function"!=typeof this[e])if(c(t,e)&&null!==t[e])if(null===this[e]||this[e].constructor!=Object)n[e]=t[e];else{n[e]={};for(a in this[e])n[e][a]=c(t[e],a)?t[e][a]:this[e][a]}else n[e]=this[e];return n}};P.settings=function(){return E};var C=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),D={airy:{n:"Airyâs Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:1,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/4,scale:230,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:195,ratio:1.5},"kavrayskiy VII":{n:"Kavrayskiy 7",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:2,clip:!1},larrivee:{n:"l'ArrivÃ©e",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};P.projections=function(){return D};var G={};G.symbol=function(){function t(t){l[a()](t)}var e,a=d3.functor("circle"),n=d3.functor(64),r=(d3.functor("#fff"),d3.functor("")),l=(d3.functor([2,2]),{circle:function(t){var a=Math.sqrt(n()),r=a/2;return t.arc(e[0],e[1],r,0,2*Math.PI),r},square:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0]-r,e[1]-r),t.lineTo(e[0]+r,e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},diamond:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]),t.lineTo(e[0],e[1]+r),t.lineTo(e[0]-r,e[1]),t.closePath(),r},ellipse:function(t){var a=Math.sqrt(n()),r=a/2;return t.save(),t.translate(e[0],e[1]),t.scale(1.6,.8),t.beginPath(),t.arc(0,0,r,0,2*Math.PI),t.closePath(),t.restore(),r},marker:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0]-a,e[1]),t.lineTo(e[0]+a,e[1]),t.closePath(),r},"cross-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0]-a,e[1]),t.lineTo(e[0]+a,e[1]),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},"stroke-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r}});return t.type=function(e){return arguments.length?(a=d3.functor(e),t):a},t.size=function(e){return arguments.length?(n=d3.functor(e),t):n},t.text=function(e){return arguments.length?(r=d3.functor(e),t):r},t.position=function(a){return arguments.length?(e=a,t):void 0},t};var _={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-names"],"stars-names":["stars-proper","stars-desig","stars-namelimit"],"dsos-show":["dsos-limit","dsos-names"],"dsos-names":["dsos-desig","dsos-namelimit"],"constellations-names":["constellations-desig"]};!function(){function t(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function e(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&o(a)}function a(t){var e=.5*t[0]*p,a=.5*t[1]*p,n=.5*t[2]*p,r=Math.sin(e),l=Math.cos(e),i=Math.sin(a),o=Math.cos(a),s=Math.sin(n),c=Math.cos(n);return[l*o*c+r*i*s,r*o*c-l*i*s,l*i*c+r*o*s,l*o*s-r*i*c]}function n(t,e){var a=t[0],n=t[1],r=t[2],l=t[3],i=e[0],o=e[1],s=e[2],c=e[3];return[a*i-n*o-r*s-l*c,a*o+n*i+r*c-l*s,a*s-n*c+r*i+l*o,a*c+n*s-r*o+l*i]}function r(t,e){if(t&&e){var a=c(t,e),n=Math.sqrt(s(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,s(t,e)))),l=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*l,-a[1]*l,a[0]*l]}}function l(t,e){var a=Math.max(-1,Math.min(1,s(t,e))),n=0>a?-1:1,r=Math.acos(n*a),l=Math.sin(r);return l?function(a){var i=n*Math.sin((1-a)*r)/l,o=Math.sin(a*r)/l;return[t[0]*i+e[0]*o,t[1]*i+e[1]*o,t[2]*i+e[2]*o,t[3]*i+e[3]*o]}:function(){return t}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*u,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*u,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*u]}function o(t){var e=t[0]*p,a=t[1]*p,n=Math.cos(a);return[n*Math.cos(e),n*Math.sin(e),Math.sin(a)]}function s(t,e){
for(var a=0,n=t.length,r=0;n>a;++a)r+=t[a]*e[a];return r}function c(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function f(t){for(var e=0,a=arguments.length,n=[];++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var l=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=l}}},r}var p=Math.PI/180,u=180/Math.PI;d3.geo.zoom=function(){function s(t){m++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function p(t){--m||t({type:"zoomend"})}var u,d,h,m=0,g=f(b,"zoomstart","zoom","zoomend"),b=d3.behavior.zoom().on("zoomstart",function(){var l=d3.mouse(this),o=a(u.rotate()),f=e(u,l);f&&(h=f),v.call(b,"zoom",function(){u.scale(y.k=d3.event.scale);var a=d3.mouse(this),s=r(h,e(u,a));u.rotate(y.r=i(o=s?n(o,s):n(t(u,l,a),o))),l=a,c(g.of(this,arguments))}),s(g.of(this,arguments))}).on("zoomend",function(){v.call(b,"zoom",null),p(g.of(this,arguments))}),v=b.on,y={r:[0,0,0],k:1};return b.rotateTo=function(t){var e=r(o(t),o([-y.r[0],-y.r[1]]));return i(n(a(y.r),e))},b.projection=function(t){return arguments.length?(u=t,y={r:u.rotate(),k:u.scale()},b.scale(y.k)):u},b.duration=function(t){return arguments.length?(d=t,b):d},b.event=function(t){t.each(function(){var t=d3.select(this),e=g.of(this,arguments),n=y,r=d3.transition(t);if(r!==t){r.each("start.zoom",function(){this.__chart__&&(y=this.__chart__),u.rotate(y.r).scale(y.k),s(e)}).tween("zoom:zoom",function(){var t=b.size()[0],o=l(a(y.r),a(n.r)),s=d3.geo.distance(y.r,n.r),f=d3.interpolateZoom([0,0,t/y.k],[s,0,t/n.k]);return d&&r.duration(d(.001*f.duration)),function(a){var n=f(a);this.__chart__=y={r:i(o(n[0]/s)),k:t/n[2]},u.rotate(y.r).scale(y.k),b.scale(y.k),c(e)}}).each("end.zoom",function(){p(e)});try{r.each("interrupt.zoom",function(){p(e)})}catch(o){console.log(o)}}else this.__chart__=y,s(e),c(e),p(e)})},d3.rebind(b,g,"on")}}(),this.Celestial=P}();